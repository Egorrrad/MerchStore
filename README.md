# MerchStore

---

Реализация тестового задания на позицию стажёра-бэкендера в Avito с использованием JWT-аутентификации, PostgreSQL и Redis.

## Тестовое задание

Тестовое задание доступно по ссылке: [Avito Backend Trainee Assignment 2025](https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Backend/Backend-trainee-assignment-winter-2025/Backend-trainee-assignment-winter-2025.md)

## Выполненные задачи
1. **Реализация сервиса**:
   - Аутентификация пользователей через JWT.
   - Покупка мерча с использованием виртуальной валюты.
   - История операций с монетами.
   - Кэширование токенов пользователей в Redis.

2. **Тестирование**:
   - Полное покрытие E2E-тестами всех путей API.
   - Частичное покрытие юнит-тестами.

3. **Контейнеризация**:
   - Сервис полностью запускается через Docker.
   - Использование `Makefile` для упрощения запуска и управления контейнерами.

4. **Линтинг**:
   - Частично настроен линтер.

## Невыполненные задачи
1. **Юнит-тесты**:
   - Не все компоненты покрыты юнит-тестами.
2. **Нагрузочное тестирование**:
   - Не проведено нагрузочное тестирование полученного решения
---

## Технологии

- **Язык программирования**: Go 1.23+
- **База данных**: PostgreSQL
- **Кэширование**: Redis
- **Аутентификация**: JWT
- **Контейнеризация**: Docker и docker-compose
- **Тестирование**:
   - Unit-тесты
   - E2E-тесты

---

## Требования

Для запуска сервиса необходимо установить:
- **Go** (версия 1.23 или выше)
- **Docker** и **docker-compose**

---

## Описание запуска

### 1. Клонирование репозитория
```bash
git clone https://github.com/yourusername/MerchStore.git
cd MerchStore
```

### 2. Запуск сервиса через Docker
Для удобства запуска сервиса используется `Makefile`. Доступные команды:
- **Запуск сервиса**:
  ```bash
  make run-service
  ```
  Эта команда соберет и запустит все контейнеры (PostgreSQL, Redis и API).

- **Остановка сервиса**:
  ```bash
  make stop-service
  ```

- **Удаление контейнеров**:
  ```bash
  make rm-service
  ```

---

## Результаты тестирования

### 1. **E2E-тесты**
E2E-тесты покрывают все пути API и запускаются в изолированном тестовом окружении, которое настраивается через Go-файл при запуске тестов.

### 2. **Юнит-тесты**
Частично реализованы юнит-тесты для ключевых компонентов (репозиторий, сервисы, обработчики).

### 3. **Запуск тестов**
Для запуска тестов выполните:
```bash
make run-tests
```
Также в консоли будет отображена краткая информация о покрытии тестами. Для получения детальной информации о покрытии можно перейти к следующемцу пункту.
### 4. **Покрытие тестами**
Для просмотра покрытия тестами выполните:
```bash
make test-cov
```

---

## Дополнительно

### 1. **Использование Redis**
Для повышения производительности сервиса токены пользователей кэшируются в Redis. Это позволяет:
- Уменьшить количество запросов к PostgreSQL.
- Ускорить процесс аутентификации.
- Снизить нагрузку на базу данных.

Каждый раз, когда пользователь аутентифицируется, его токен сохраняется в Redis. При последующих запросах токен проверяется сначала в Redis, и только если он отсутствует, выполняется запрос к PostgreSQL.

### 2. **Makefile**
Для упрощения работы с сервисом используется `Makefile`:
- **Запуск сервиса**: `make run-service`
- **Остановка сервиса**: `make stop-service`
- **Удаление контейнеров**: `make rm-service`
- **Запуск тестов**: `make run-tests`

### 3. **E2E-тесты**
E2E-тесты запускаются в изолированном окружении, которое настраивается через Go-файл. Это позволяет:
- Запускать тесты независимо от основного окружения.
- Использовать тестовую базу данных и Redis.
- Очищать данные после каждого теста.